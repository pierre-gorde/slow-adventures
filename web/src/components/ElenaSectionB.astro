---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import SectionReveal from './SectionReveal.astro';
import CTAButton from './CTAButton.astro';

interface Props {
  id?: string;
  imageSrc: ImageMetadata;
  imageAlt: string;
  title: string;
  description: string;
  ctaHref: string;
}

const { id, imageSrc, imageAlt, title, description, ctaHref } = Astro.props;
---

<section
  id={id}
  aria-labelledby="heading-elena-b"
  class="bg-creme sa-section-padding"
>
  <p class="text-center text-warm-gray font-sans text-sm uppercase tracking-widest mb-8">
    Option B — Blob organique + halo gradient animé
  </p>
  <div
    class="max-w-6xl mx-auto flex flex-col items-center text-center lg:flex-row lg:items-center lg:text-left lg:gap-16"
  >
    <div class="lg:w-2/5">
      <SectionReveal animation="scale-in">
        <div class="elena-b__photo-wrapper">
          <div class="elena-b__glow" aria-hidden="true"></div>
          <div class="elena-b__blob">
            <Image
              src={imageSrc}
              alt={imageAlt}
              widths={[250, 400, 600]}
              sizes="(min-width: 1024px) 40vw, 250px"
              loading="lazy"
              decoding="async"
              class="elena-b__photo"
            />
          </div>
        </div>
      </SectionReveal>
    </div>
    <div class="lg:w-3/5">
      <SectionReveal animation="fade-in" delay={200}>
        <div class="mt-8 lg:mt-0">
          <h2
            id="heading-elena-b"
            class="font-serif text-3xl md:text-4xl text-warm-black mb-4"
          >
            {title}
          </h2>
          <p class="font-sans text-warm-black/90 text-lg leading-relaxed mb-8">
            {description}
          </p>
          <CTAButton
            href={ctaHref}
            variant="solid"
            size="small"
            subtext=""
            desktopOnly={true}
          />
        </div>
      </SectionReveal>
    </div>
  </div>
</section>

<style>
  .elena-b__photo-wrapper {
    position: relative;
    width: 280px;
    height: 280px;
    margin: 0 auto;
  }

  @media (min-width: 768px) {
    .elena-b__photo-wrapper {
      width: 380px;
      height: 380px;
    }
  }

  @media (min-width: 1024px) {
    .elena-b__photo-wrapper {
      width: 100%;
      height: auto;
      aspect-ratio: 1;
      margin: 0;
    }
  }

  .elena-b__glow {
    position: absolute;
    inset: -16px;
    border-radius: 50%;
    background: conic-gradient(
      from 0deg,
      var(--color-terracotta),
      var(--color-ambre),
      var(--color-sauge),
      var(--color-terracotta-muted),
      var(--color-terracotta)
    );
    opacity: 0.5;
    filter: blur(20px);
    animation: elena-b-rotate 8s linear infinite;
  }

  @keyframes elena-b-rotate {
    to {
      transform: rotate(360deg);
    }
  }

  .elena-b__blob {
    position: relative;
    z-index: 1;
    width: 100%;
    height: 100%;
    clip-path: path(
      'M240,120 C240,186.3 186.3,240 120,240 C53.7,240 0,186.3 0,120 C0,53.7 53.7,0 120,0 C186.3,0 240,53.7 240,120'
    );
    overflow: hidden;
    animation: elena-b-morph 6s ease-in-out infinite alternate;
  }

  @keyframes elena-b-morph {
    0% {
      border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
    }
    50% {
      border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%;
    }
    100% {
      border-radius: 50% 40% 60% 50% / 40% 60% 50% 60%;
    }
  }

  .elena-b__blob {
    clip-path: none;
    border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
  }

  .elena-b__photo {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  @media (prefers-reduced-motion: reduce) {
    .elena-b__glow {
      animation: none;
    }
    .elena-b__blob {
      animation: none;
      border-radius: 50%;
    }
  }
</style>

<script>
  import { gsap } from '../lib/gsap';

  function initElenaB() {
    const wrapper = document.querySelector('.elena-b__photo-wrapper');
    if (!wrapper) return;

    const blob = wrapper.querySelector('.elena-b__blob');
    if (!blob) return;

    gsap.fromTo(
      blob,
      { scale: 0.8, opacity: 0 },
      {
        scale: 1,
        opacity: 1,
        duration: 1,
        ease: 'back.out(1.4)',
        scrollTrigger: {
          trigger: wrapper,
          start: 'top 80%',
          once: true,
        },
      }
    );
  }

  initElenaB();
</script>

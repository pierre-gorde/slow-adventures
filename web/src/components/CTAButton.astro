---
interface Props {
  text?: string;
  subtext?: string;
  href: string;
  size?: 'default' | 'small';
  variant?: 'solid' | 'outline' | 'ghost';
  desktopOnly?: boolean;
}

const {
  text = 'Confie-moi ton prochain rÃªve',
  subtext = '30 min, gratuit, sans engagement',
  href,
  size = 'default',
  variant = 'solid',
  desktopOnly = false,
} = Astro.props;

const sizeClasses =
  size === 'small'
    ? 'px-6 py-3 text-sm lg:px-8 lg:py-4 lg:text-base'
    : 'px-8 py-4 text-base lg:px-10 lg:py-5 lg:text-lg';

const variantClasses = {
  solid:
    'bg-terracotta text-white border-2 border-terracotta active:bg-terracotta-dark',
  outline: 'bg-transparent text-white border-2 border-white hover:bg-white/10',
  ghost:
    'bg-transparent text-terracotta border-2 border-transparent hover:bg-terracotta/10',
}[variant];

const visibilityClass = desktopOnly ? 'hidden lg:inline-block' : '';
---

<span class="cta-wrapper inline-block relative">
  <span class="cta-glow" aria-hidden="true"></span>
  <a
    href={href}
    data-calendly-trigger
    data-cta
    class:list={[
      'cta-btn relative inline-block font-sans font-semibold text-center motion-safe:hover:scale-[1.02]',
      sizeClasses,
      variantClasses,
      visibilityClass,
    ]}
  >
    {text}
    {
      subtext && (
        <span class="block text-xs lg:text-sm font-normal mt-1 opacity-80">
          {subtext}
        </span>
      )
    }
  </a>
</span>

<style>
  .cta-wrapper {
    position: relative;
  }

  .cta-glow {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      135deg,
      var(--color-terracotta),
      var(--color-ambre),
      var(--color-sauge)
    );
    opacity: 0.25;
    filter: blur(8px);
    z-index: 0;
    border-radius: 2rem 2.8rem 2rem 2.8rem;
    animation: cta-glow-morph 6s ease-in-out infinite alternate;
    transform: translate(4px, 4px);
  }

  .cta-btn {
    position: relative;
    z-index: 1;
    border-radius: 2rem 2.8rem 2rem 2.8rem;
    animation: cta-morph 6s ease-in-out infinite alternate;
    transition: transform 0.3s;
  }

  @keyframes cta-morph {
    0% {
      border-radius: 2rem 2.8rem 2rem 2.8rem;
    }
    33% {
      border-radius: 2.6rem 2rem 2.8rem 2.2rem;
    }
    66% {
      border-radius: 2.2rem 2.6rem 2rem 2.8rem;
    }
    100% {
      border-radius: 2.8rem 2.2rem 2.6rem 2rem;
    }
  }

  @keyframes cta-glow-morph {
    0% {
      border-radius: 2rem 2.8rem 2rem 2.8rem;
      transform: translate(4px, 4px);
    }
    33% {
      border-radius: 2.6rem 2rem 2.8rem 2.2rem;
      transform: translate(6px, 2px);
    }
    66% {
      border-radius: 2.2rem 2.6rem 2rem 2.8rem;
      transform: translate(2px, 6px);
    }
    100% {
      border-radius: 2.8rem 2.2rem 2.6rem 2rem;
      transform: translate(4px, 4px);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .cta-btn {
      animation: none;
      border-radius: 9999px;
    }
    .cta-glow {
      animation: none;
      border-radius: 9999px;
    }
  }
</style>

---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import SectionReveal from './SectionReveal.astro';
import CTAButton from './CTAButton.astro';

interface Props {
  id?: string;
  imageSrc: ImageMetadata;
  imageAlt: string;
  title: string;
  description: string;
  ctaHref: string;
}

const { id, imageSrc, imageAlt, title, description, ctaHref } = Astro.props;
---

<section
  id={id}
  aria-labelledby="heading-elena-c"
  class="bg-creme sa-section-padding"
>
  <p class="text-center text-warm-gray font-sans text-sm uppercase tracking-widest mb-8">
    Option C — Cadre décalé avec accent gradient
  </p>
  <div
    class="max-w-6xl mx-auto flex flex-col items-center text-center lg:flex-row lg:items-center lg:text-left lg:gap-16"
  >
    <div class="lg:w-2/5">
      <SectionReveal animation="scale-in">
        <div class="elena-c__photo-wrapper">
          <div class="elena-c__frame" aria-hidden="true"></div>
          <Image
            src={imageSrc}
            alt={imageAlt}
            widths={[250, 400, 600]}
            sizes="(min-width: 1024px) 40vw, 250px"
            loading="lazy"
            decoding="async"
            class="elena-c__photo"
          />
        </div>
      </SectionReveal>
    </div>
    <div class="lg:w-3/5">
      <SectionReveal animation="fade-in" delay={200}>
        <div class="mt-8 lg:mt-0">
          <h2
            id="heading-elena-c"
            class="font-serif text-3xl md:text-4xl text-warm-black mb-4"
          >
            {title}
          </h2>
          <p class="font-sans text-warm-black/90 text-lg leading-relaxed mb-8">
            {description}
          </p>
          <CTAButton
            href={ctaHref}
            variant="solid"
            size="small"
            subtext=""
            desktopOnly={true}
          />
        </div>
      </SectionReveal>
    </div>
  </div>
</section>

<style>
  .elena-c__photo-wrapper {
    position: relative;
    width: 250px;
    margin: 0 auto;
  }

  @media (min-width: 768px) {
    .elena-c__photo-wrapper {
      width: 350px;
    }
  }

  @media (min-width: 1024px) {
    .elena-c__photo-wrapper {
      width: 100%;
      margin: 0;
    }
  }

  .elena-c__frame {
    position: absolute;
    inset: 0;
    border-radius: 1rem;
    background: linear-gradient(
      135deg,
      var(--color-terracotta),
      var(--color-ambre),
      var(--color-sauge)
    );
    transform: translate(12px, 12px);
    z-index: 0;
  }

  .elena-c__photo {
    position: relative;
    z-index: 1;
    width: 100%;
    aspect-ratio: 4 / 5;
    object-fit: cover;
    border-radius: 1rem;
    display: block;
  }

  @media (prefers-reduced-motion: reduce) {
    .elena-c__frame {
      transition: none;
    }
  }
</style>

<script>
  import { gsap, ScrollTrigger } from '../lib/gsap';

  function initElenaC() {
    const wrapper = document.querySelector('.elena-c__photo-wrapper');
    if (!wrapper) return;

    const frame = wrapper.querySelector<HTMLElement>('.elena-c__frame');
    const photo = wrapper.querySelector<HTMLElement>('.elena-c__photo');
    if (!frame || !photo) return;

    gsap.set(frame, { xPercent: 0, yPercent: 0, opacity: 0 });

    const tl = gsap.timeline({
      scrollTrigger: {
        trigger: wrapper,
        start: 'top 80%',
        once: true,
      },
    });

    tl.fromTo(
      photo,
      { y: 40, opacity: 0 },
      { y: 0, opacity: 1, duration: 0.7, ease: 'power2.out' }
    ).fromTo(
      frame,
      { x: 0, y: 0, opacity: 0 },
      { x: 12, y: 12, opacity: 1, duration: 0.5, ease: 'power2.out' },
      '-=0.3'
    );

    // Subtle parallax on scroll
    gsap.to(frame, {
      y: 24,
      ease: 'none',
      scrollTrigger: {
        trigger: wrapper,
        start: 'top bottom',
        end: 'bottom top',
        scrub: 1,
      },
    });
  }

  initElenaC();
</script>

---
import { Image, getImage } from 'astro:assets';
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import HeroSection from '../components/HeroSection.astro';
import ElenaSection from '../components/ElenaSection.astro';
import DestinationBlock from '../components/DestinationBlock.astro';
import SectionReveal from '../components/SectionReveal.astro';
import ProcessStep from '../components/ProcessStep.astro';
import TestimonialCard from '../components/TestimonialCard.astro';
import PricingRow from '../components/PricingRow.astro';
import CTAButton from '../components/CTAButton.astro';
import EmailCapture from '../components/EmailCapture.astro';
import CalendlyModal from '../components/CalendlyModal.astro';
import StickyMobileCTA from '../components/StickyMobileCTA.astro';
import ScrollProgress from '../components/ScrollProgress.astro';
import heroPoster from '../assets/images/hero-poster.webp';
import heroLogo from '../assets/images/logo-white.png';
import elenaPhoto from '../assets/images/elena.webp';
import testimonialsBg from '../assets/images/testimonials-bg.webp';
import { processSteps } from '../data/processSteps';
import { testimonials } from '../data/testimonials';
import { pricingRows } from '../data/pricing';

const destinations = await getCollection('destinations');
const sortedDestinations = [...destinations].sort(
  (a, b) => a.data.order - b.data.order
);

const optimizedPoster = await getImage({
  src: heroPoster,
  width: 1440,
  format: 'webp',
});
---

<BaseLayout
  title="Slow Adventures — Voyages immersifs et sur mesure exclusivement aux Amériques"
  description="Création de voyages immersifs et sur mesure exclusivement aux Amériques. Discovery call gratuit de 30 minutes."
  heroPreloadImage={optimizedPoster.src}
>
  <header>
    <HeroSection
      posterSrc={heroPoster}
      videoSrc="/videos/hero.mp4"
      logoSrc={heroLogo}
      title="Slow Adventures"
      subtitle="Voyages immersifs et sur mesure exclusivement aux Amériques"
    />
  </header>
  <main id="main">
    <ElenaSection
      id="elena"
      imageSrc={elenaPhoto}
      imageAlt="Elena, créatrice de voyages immersifs aux Amériques"
      title="Hello, Hola, Olà"
      description="Moi c'est Elena. Après des mois à parcourir l'Amérique latine à sac à dos et plusieurs voyages en Amérique du Nord, j'ai créé SlowAdventures pour te proposer des voyages authentiques, fluides et 100% sur mesure. Mon approche&nbsp;? Écouter tes rêves, transformer tes envies en itinéraires uniques, et t'ouvrir les portes d'expériences mémorables. Si tu veux un voyage qui te ressemble vraiment, qui te connecte à l'âme des lieux et qui te laisse des souvenirs gravés pour toujours… tu es au bon endroit."
      ctaHref={import.meta.env.PUBLIC_CALENDLY_URL}
    />
    <section id="destinations" aria-labelledby="heading-destinations">
      <h2 id="heading-destinations" class="sr-only">Nos destinations</h2>
      {
        sortedDestinations.map((dest) => (
          <SectionReveal animation="fade-in">
            <DestinationBlock
              imageSrc={dest.data.image}
              imageAlt={`Paysage de ${dest.data.country}`}
              country={dest.data.country}
              description={dest.data.description}
              overlayColor={dest.data.overlayColor}
            />
          </SectionReveal>
        ))
      }
    </section>
    <section
      id="processus"
      aria-labelledby="heading-processus"
      class="bg-creme sa-section-padding"
    >
      <div class="max-w-5xl mx-auto">
        <h2
          id="heading-processus"
          class="font-serif text-3xl md:text-4xl text-warm-black text-center mb-12"
        >
          La construction de TON aventure
        </h2>
        <SectionReveal animation="stagger">
          <ol
            class="grid grid-cols-1 md:grid-cols-2 gap-8 lg:gap-12 list-none p-0"
          >
            {
              processSteps.map((step) => (
                <ProcessStep
                  number={step.number}
                  title={step.title}
                  description={step.description}
                  icon={step.icon}
                />
              ))
            }
          </ol>
        </SectionReveal>
      </div>
    </section>
    <section
      id="temoignages"
      aria-labelledby="heading-temoignages"
      class="relative min-h-[70vh] overflow-hidden"
    >
      <Image
        src={testimonialsBg}
        alt=""
        widths={[768, 1440, 2880]}
        sizes="100vw"
        loading="lazy"
        decoding="async"
        class="absolute inset-0 w-full h-full object-cover"
      />
      <div class="absolute inset-0 bg-ambre/60"></div>
      <div class="relative z-10 sa-section-padding max-w-5xl mx-auto">
        <h2
          id="heading-temoignages"
          class="font-serif text-3xl md:text-4xl text-white text-center mb-12"
        >
          Ils ont vécu SlowAdventures
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-3xl mx-auto">
          {
            testimonials.map((t) => (
              <SectionReveal animation="fade-up">
                <TestimonialCard
                  quote={t.quote}
                  name={t.name}
                  tripContext={t.tripContext}
                />
              </SectionReveal>
            ))
          }
        </div>
        <div class="text-center mt-12">
          <CTAButton
            href={import.meta.env.PUBLIC_CALENDLY_URL}
            variant="solid"
            size="small"
            text="Réserve ton discovery call ici"
            subtext=""
            desktopOnly={true}
          />
        </div>
      </div>
    </section>
    <section
      id="tarifs"
      aria-labelledby="heading-tarifs"
      class="bg-creme sa-section-padding"
    >
      <div class="max-w-3xl mx-auto">
        <h2
          id="heading-tarifs"
          class="font-serif text-3xl md:text-4xl text-warm-black text-center mb-12"
        >
          Ici, on est transparent
        </h2>
        <SectionReveal animation="stagger">
          <dl class="space-y-6">
            {
              pricingRows.map((row) => (
                <PricingRow
                  label={row.label}
                  price={row.price}
                  description={row.description}
                />
              ))
            }
          </dl>
        </SectionReveal>
      </div>
    </section>
    <section
      id="cta-final"
      aria-labelledby="heading-cta-final"
      class="bg-warm-black sa-section-padding"
    >
      <div class="max-w-3xl mx-auto text-center">
        <SectionReveal animation="scale-in">
          <h2
            id="heading-cta-final"
            class="font-serif text-3xl md:text-4xl lg:text-5xl text-white mb-8"
          >
            Ton prochain rêve commence ici
          </h2>
          <CTAButton
            href={import.meta.env.PUBLIC_CALENDLY_URL}
            variant="solid"
            size="default"
            subtext="30 min, gratuit, sans engagement"
          />
        </SectionReveal>
      </div>
    </section>
    <SectionReveal animation="fade-in">
      <EmailCapture />
    </SectionReveal>
  </main>
  <CalendlyModal />
  <StickyMobileCTA />
  <ScrollProgress />
</BaseLayout>
